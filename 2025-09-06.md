# 总结

## 1. 视觉层次融合（\$V\_{fused}\$）

* 融合 ViT 的浅层、中层、倒数第二层和最终层，兼顾细节与高层语义。
  * **层选择**：不同层语义差异大（浅层→像素/边缘，中层→语义单元，倒二层→空间结构）。
  * **标准化/投影**：避免层间分布不一致。
  * **融合机制**：加权、跨层注意力、门控（静态 or 动态，是否依赖 caption/图像类型）。
  * **监督与正则**：是否需要层级 loss，避免 collapse 到单层。
  * **可解释性**：融合后能否保留 layer 来源信息，支持定位/解释。

---

## 2. 空间层次融合（\$S\_{fused}\$）

* 通过 tiles（局部细节）+ 缩略图（全局语义）互补，构建高分辨率表征。
  * **Tile 策略**：尺寸384*384/数量；均匀网格。
  * **共享权重**：同一ViT权重。
  * **位置编码**：加入绝对/相对坐标。
  * **聚合方式**：mean pooling。
  * **缩略图作用**：如何防止缩略图语义被压制（用其做 query）。
  * **OCR 融合**：向量融合，处理 OCR 错误。
  * **监督信号**：tile 的正负样本定义（只要匹配上，该图片的所有tile，所有判定为正例，同batch其余图片的tile作为负例）。

---

## 3. 视觉 + 空间统一融合（\$I\_{fused}\$）

* 利用 caption 作为引导信号，将 \$V\_{fused}\$ 与 \$S\_{fused}\$ 条件化融合。
  * **注入时机**：融合后caption作为额外信号引导。
  * **条件化机制**：cross-attention（caption 作 query）。
  * **鲁棒性**：caption 噪声（过短/笼统/错误）如何缓解（mask/dropout）。
  * **梯度冲突**：跨模态融合，可能出现梯度冲突。
  * **多粒度注入**：是否按词/句分层注入。
  * **可解释性**：融合后是否还能追溯到 tile/layer。

---

## 4. 文本层次建模

* 构建多粒度文本表征（词、句、块），支持长文本对齐。
  * **分块策略**：段落/小节/LLM 辅助切分，平衡 recall 与 precision。
  * **句级聚合**：\[CLS] 。
  * **结构建模**：块内 Transformer 层数（两层hi-transformer层），位置/角色 embedding。
  * **预训练任务**：是否需要 MLM/顺序预测以稳定表示。
  * **显式先验**：图表引用“如图3所示”是否直接赋予权重。

---

## 5. 跨模态对齐与损失设计

* 实现从全局到局部的多粒度对齐。
  * **全局对齐**：InfoNCE（双向/单向，负样本采样策略）。
  * **局部对齐**：句↔tile，方法包括 MIL（mean/max）、Optimal Transport、token 对比。
  * **辅助损失**：ITM（二分类匹配）对 hard negative 有帮助，但会引入目标冲突。
  * **多正样本处理**：log-sum-exp vs max/mean pooling。
  * **温度参数 τ**：可学习性、层级化设计（全局 vs 局部）。
  * **损失调度**：课程式训练（先全局后局部）、动态调度（GradNorm、Uncertainty weighting）。
  * **负样本来源**：同论文 vs 跨论文，需重点关注同论文 hard negative。

---

## 6. 训练策略与稳定性

* 阶段化训练：单模态预训练 → 融合 → 跨模态微调。
* 多损失优化：检测梯度冲突（GradNorm、Uncertainty weighting、PCGrad）。
* 样本策略：memory bank 提升负样本数量，hard negative 挖掘需控制频率/比例。
* 数据偏差：结构差异、caption 差异需增强（shuffle、改写、跨领域微调）。

---

## 7. 推理

* 粗排：块级 embedding（快速召回）。
* 精排：tile/句级 embedding（细粒度排序）。
* 索引存储：需平衡存储开销与召回精度。
* 推理加速：量化/低精度计算需验证对排名的影响。

---

## 8. 评估

* 全局检索：Recall\@K、nDCG\@K、MRR。
* 局部对齐：tile ↔ 句定位准确度，attention 可解释性。
* 泛化测试：跨领域、跨图表类型。
* 错配检测：全局对齐成功但局部错误时需有额外指标。

---

## 9. Caption 与 OCR 噪声

* Caption 矛盾或笼统 → dropout 或重写增强。
* OCR 错误（表格/公式） → token vs 向量融合备份通道。
* 局部错配风险 → 需要局部一致性指标保障可靠性。

---

